<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>PTS Admin Console</title>
    <link rel="stylesheet" href="/static/styles.css" />
  </head>
  <body>
    <header class="topbar">
      <div class="topbar-left">
        <h1>Telemetry Console</h1>
        <span class="subtitle">Platform Event Stream</span>
      </div>

      <div class="controls">
        <label>
          Limit
          <input id="limit" type="number" value="20" min="1" max="200" />
        </label>
        <button onclick="loadEvents()">Refresh</button>
      </div>
    </header>

    <main class="container">
      <div id="events" class="event-grid"></div>
    </main>

    <script>
      async function loadEvents() {
        const limit = document.getElementById("limit").value;
        const response = await fetch(`/events?limit=${limit}`);
        const data = await response.json();

        const container = document.getElementById("events");
        container.innerHTML = "";

        data.forEach((event) => {
          const card = document.createElement("div");
          card.className = "event-card";

          card.innerHTML = `
            <div class="card-header">
                <span class="event-type">${event.event_type}</span>
                <span class="event-time">${formatDate(event.received_at)}</span>
            </div>

            <div class="card-meta">
                <div>
                    <span class="meta-label">Event ID</span>
                    <span class="meta-value">${event.id}</span>
                </div>
            </div>

            <details class="payload">
                <summary>View Payload</summary>
                <pre>${JSON.stringify(event.payload, null, 2)}</pre>
            </details>
        `;

          container.appendChild(card);
        });
      }

      function formatDate(dateStr) {
        const date = new Date(dateStr);
        return date.toLocaleString();
      }

      loadEvents();
    </script>
  </body>
</html>
